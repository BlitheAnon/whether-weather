import{g as R,d as D,q as E,y,$ as T,u as m,F as w,C as S,i as q,a as O,T as b,b as j,k as A,r as L,c as H,e as M,o as F,O as _}from"./stylex-BUNdXQ4s.js";const B=()=>document.querySelector("cart-drawer")||document.querySelector("dialog.cart-drawer__dialog")||document.querySelector("m-cart-drawer"),N=()=>{var e;return(e=document.querySelector(".order-value-booster-side-cart"))==null?void 0:e.parentElement},$=()=>{const e=document.querySelectorAll("cart-notification .cart-notification__links");return e[e.length-1]},z=()=>{const e=document.querySelectorAll(".side-cart");return e[e.length-1]},G=()=>document.querySelector('form[action$="/cart"]'),U=()=>document.querySelector(".essential-upsell-side-cart"),Q=()=>{const e=document.querySelector(".essential-upsell-side-cart-top, .essential-upsell-side-cart-bottom");return e?e.parentElement:null},P=()=>U()||Q()||N()||$()||z()||G(),p=()=>B()||P(),V=({defaultPlacementSelectors:e})=>{for(const t of e){const r=document.querySelector(t);if(r)return r}return null},Y=({isFallbackActive:e})=>e?R()||document.querySelector("product-info"):null,x=({defaultPlacementSelectors:e,isFallbackActive:t})=>V({defaultPlacementSelectors:e})||Y({isFallbackActive:t}),J=({setPortalContainer:e,defaultPlacementSelectors:t,isFallbackActive:r})=>{const n=x({defaultPlacementSelectors:t,isFallbackActive:r});return n?(e(n),()=>{e(null)}):null},C=({selectors:e})=>e.map(t=>Array.from(document.querySelectorAll(t))).flat(),I=({appBlockSelectors:e,manualBlockSelectors:t,defaultPlacementSelectors:r,isFallbackActive:n})=>{const[s,l]=D(null),c=E(()=>{const i=p(),a=C({selectors:e});return Array.from(a).some(d=>i?!i.contains(d):!0)?null:J({setPortalContainer:l,defaultPlacementSelectors:r,isFallbackActive:n})},[e,r,n]),o=E(()=>{const i=p(),u=C({selectors:t}).find(d=>i?!i.contains(d):!1);if(u){l(u);return}return c()},[c,t]);return y(o,[o]),{productPagePortalContainer:s}},K=({funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:n,shopMoneyFormat:s})=>{const{productPagePortalContainer:l}=I({appBlockSelectors:["essential-upsell-cross-sell-app-block"],manualBlockSelectors:[".essential-upsell-cross-sell-block",".essential-upsell-block"],defaultPlacementSelectors:[".essential-upsell-cross-sell-default-placement",".essential-upsell-default-placement"],isFallbackActive:!!t});return l?T(m(w,{funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:n,shopMoneyFormat:s}),l):null},W=()=>document.querySelector("cart-items.page-width")||document.querySelector("cart-items .page-width")||document.querySelector("cart-items")||document.querySelector("cart-items-component .cart-page .cart-page__items"),v=({funnel:e,element:t,setPortalContainer:r})=>{const n=document.createElement("div");return e.placement.cartPagePositionType===S.TOP_OF_THE_CART?t.prepend(n):e.placement.cartPagePositionType===S.BOTTOM_OF_THE_CART&&t.append(n),r(n),()=>{r(null),n.remove()}},k=({funnel:e,element:t,setPortalContainer:r})=>{if(e.placement.cartPagePositionType===S.TOP_OF_THE_CART){const n=t.querySelector(".essential-upsell-side-cart-top");if(n)return r(n),()=>{r(null)};if(t.querySelector("cart-drawer-items.is-empty")||t.classList.contains("cart-drawer--empty")){r(null);return}const s=t.querySelector("cart-drawer-items:not(.is-empty)")||t.querySelector(".drawer__scrollable");if(s){const o=document.createElement("div");return s.append(o),r(o),()=>{r(null),o.remove()}}const l=t.querySelector("scroll-hint.cart-drawer__items");if(l){const o=document.createElement("div");return l.prepend(o),r(o),()=>{r(null),o.remove()}}const c=document.createElement("div");return t.prepend(c),r(c),()=>{r(null),c.remove()}}else if(e.placement.cartPagePositionType===S.BOTTOM_OF_THE_CART){const n=t.querySelector(".essential-upsell-side-cart-bottom");if(n)return r(n),()=>{r(null)};const s=t.querySelector(".drawer__footer");if(s){const o=document.createElement("div");return s.prepend(o),r(o),()=>{r(null),o.remove()}}const l=t.querySelector("scroll-hint.cart-drawer__items");if(l){const o=document.createElement("div");return l.append(o),r(o),()=>{r(null),o.remove()}}const c=document.createElement("div");return t.append(c),r(c),()=>{r(null),c.remove()}}},X=()=>{if(!q())return null;const e=document.querySelectorAll('form[action$="/cart"]'),t=e[e.length-1];return t?t.parentNode:null},Z=({funnel:e,setPortalContainer:t})=>{const r=W();if(r)return v({funnel:e,element:r,setPortalContainer:t});const n=B();if(n)return k({funnel:e,element:n,setPortalContainer:t});const s=X();if(s)return v({funnel:e,element:s,setPortalContainer:t});const l=P();if(l)return k({funnel:e,element:l,setPortalContainer:t})},ee=({funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:n,shopMoneyFormat:s})=>{const[l,c]=D(null),o=E(()=>{const a=q()?document:p();return a&&a.querySelector("essential-upsell-cross-sell-app-block")?null:Z({funnel:e,setPortalContainer:c})},[e]),i=E(()=>{const a=q()?document:p(),u=a&&(a.querySelector(".essential-upsell-cross-sell-block")||a.querySelector(".essential-upsell-block"));if(u){c(u);return}return o()},[o]);return y(i,[i]),y(()=>{if(!l)return;const a=new MutationObserver(u=>{u.some(h=>Array.from(h.removedNodes).some(g=>g.contains(l)))&&(c(null),l.remove(),i())});return a.observe(document.body,{childList:!0,subtree:!0}),()=>{a.disconnect()}},[i,l]),y(()=>{if(l)return;const a=p();if(!a)return;const u=new MutationObserver(d=>{d.some(g=>Array.from(g.addedNodes).some(f=>!(f instanceof Element)||!f.querySelector?!1:!!f.querySelector("cart-drawer-items:not(.is-empty)")||!!f.querySelector(".essential-upsell-side-cart-top, .essential-upsell-side-cart-bottom")))&&o()});return u.observe(a,{childList:!0,subtree:!0}),()=>{u.disconnect()}},[o,l]),l?T(m(w,{funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:n,shopMoneyFormat:s}),l):null},te=({funnels:e,productPageProduct:t,productPageCollectionIds:r,cartItems:n,firstShopProductId:s,shopMoneyFormat:l})=>{const c=O({funnels:e,productPageProduct:t,productPageCollectionIds:r}),o=b(()=>j({funnels:e,cartItems:n}),[e,n]);return m(A,{children:[c&&m(K,{funnel:c,productPageProduct:t,cartItems:n,firstShopProductId:s,shopMoneyFormat:l}),o&&m(ee,{funnel:o,productPageProduct:t,cartItems:n,firstShopProductId:s,shopMoneyFormat:l})]})},re=({funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:n,shopMoneyFormat:s,productPageCollectionIds:l})=>{const{productPagePortalContainer:c}=I({appBlockSelectors:["essential-upsell-frequently-bought-together-app-block"],manualBlockSelectors:[".essential-upsell-frequently-bought-together-block"],defaultPlacementSelectors:[".essential-upsell-frequently-bought-together-default-placement",".essential-upsell-default-placement"],isFallbackActive:!!t});return c?T(m(w,{funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:n,shopMoneyFormat:s,productPageCollectionIds:l}),c):null},ne=({funnels:e,productPageProduct:t,productPageCollectionIds:r,cartItems:n,firstShopProductId:s,shopMoneyFormat:l})=>{const c=O({funnels:e,productPageProduct:t,productPageCollectionIds:r});return c?m(re,{funnel:c,productPageProduct:t,cartItems:n,firstShopProductId:s,shopMoneyFormat:l,productPageCollectionIds:r}):null},le=e=>{const{funnels:t,productPageCollectionIds:r,cartItems:n,firstShopProductId:s,productPageProduct:l,shopMoneyFormat:c}=H({liquidProps:e}),{cartItems:o}=M({liquidCartItems:n}),i=b(()=>t.filter(u=>F({funnel:u})===_.FREQUENTLY_BOUGHT_TOGETHER),[t]),a=b(()=>t.filter(u=>F({funnel:u})===_.CROSS_SELL),[t]);return m(A,{children:[m(ne,{funnels:i,productPageProduct:l,productPageCollectionIds:r,cartItems:o,firstShopProductId:s,shopMoneyFormat:c}),m(te,{funnels:a,productPageProduct:l,productPageCollectionIds:r,cartItems:o,firstShopProductId:s,shopMoneyFormat:c})]})};L(le,"essential-upsell-app-embed",["upsellAppData","productPageProduct","productPageCollectionIds","cartItems","firstShopProductId","shopMoneyFormat"]);

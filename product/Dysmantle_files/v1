(()=>{var t={426:()=>{window.requestIdleCallback=window.requestIdleCallback||function(t){const e=Date.now();return setTimeout((function(){t({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-e))}})}),1)},window.cancelIdleCallback=window.cancelIdleCallback||function(t){clearTimeout(t)}}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,i),r.exports}(()=>{"use strict";const t=async t=>new Promise(((e,i)=>{const n=new XMLHttpRequest;n.onload=()=>{e(n.responseText)},n.onerror=()=>{i(new Error("Local request failed"))},n.open("GET",t),n.send()})),e=async e=>JSON.parse(await t(e)),n=new Map,s=async(t,i)=>{const s=`${t}/assets/locales/${i}.json`;if(!n.has(s)){const t=await e(s);t&&n.set(s,t)}return n.get(s)},r=(t,e,i=0,n=0)=>new Intl.NumberFormat(t,{minimumFractionDigits:i,maximumFractionDigits:n}).format(e),a=t=>(e,i,n)=>{const s=new RegExp(`{${i},[ ]*number}`,"g");return e.replaceAll(s,r(t,+n))},o=(t,e,i)=>{const n=new RegExp(`{${e}, plural, .+?}}`,"g");let s=new RegExp("=0[ ]*{(.*?)}","g");const r=+i;1===r?s=new RegExp("one[ ]*{(.*?)}","g"):r>1&&(s=new RegExp("other[ ]*{(.*?)}","g"));const a=s.exec(t);return a?t.replaceAll(n,a[1].replace("#",i)):t},l=(t,e,i)=>t.replaceAll(`{${e}}`,i),c=(t,e,i)=>{const n=new RegExp(`{${e}, select, .+?}[ ]*}`,"g"),s=new RegExp(`${i}[ ]*{(.*?)}`,"g").exec(t);return s?t.replaceAll(n,s[1]):t},d=async(t,e,i,n)=>{let r;try{if(r=await s(t,e),!r)throw new Error(`Could not find ${e} object`)}catch(e){r=await s(t,"en-GB")}if(!r)return i;let d=r[i];return d||(d=i.split(".").reduce(((t,e)=>t[e]),r)),d&&((t,e,i)=>{if(!e||!i)return e;const n=[o,a(t),l,c];return Object.entries(i).reduce(((t,[e,i])=>n.reduceRight(((t,n)=>n(t,e,i)),t)),e)})(e,d,n)||i},h=t=>e=>{customElements.get(t.selector)||customElements.define(t.selector,e)},u=t=>{const e=unescape(encodeURIComponent(t));let i="";for(let t=0;t<e.length;t++)i+=e.charCodeAt(t).toString(16);return i};var p;!function(t){t.MPN="mpn",t.GTIN="gtin",t.SKU="sku"}(p||(p={}));const m=p;class g{identifiers;type;constructor(t,e,i){if(t)this.identifiers=t,this.type=m.SKU;else if(e)this.identifiers=e,this.type=m.GTIN;else{if(!i)throw new Error("No product identifier data attribute found.");this.identifiers=i,this.type=m.MPN}}getIdentifiers(){return this.identifiers}getEncodedIdentifiers(){return this.type===m.SKU?this.identifiers.map((t=>u(t))):this.identifiers}getCombinedIdentifier(){return this.type===m.SKU?this.identifiers.map((t=>({identifier:t,encoded:u(t)}))):this.identifiers.map((t=>({identifier:t,encoded:null})))}getType(){return this.type}}const v="$_PRODUCT_IDENTIFIER",T=async t=>{const i=await e(t);if("object"==typeof(n=i)&&0===Object.keys(n).length)throw new Error("Server returned empty object!");var n;return i},E=async(t,e,i,n)=>{const s=t.replace("$_PRODUCT_IDENTIFIER_TYPE",e).replace(v,i).replace("$_FILTER","default/all").concat(n||"");return T(s)},b=["oneStar","twoStars","threeStars","fourStars","fiveStars"];var f;!function(t){t.AGGREGATERATING="AggregateRating",t.PRODUCTGROUP="ProductGroup",t.PRODUCT="Product",t.OFFER="Offer",t.REVIEW="Review",t.RATING="Rating",t.PERSON="Person",t.BRAND="Brand",t.ORGANIZATION="Organization"}(f||(f={}));const w=f,y=t=>{const e=t.firstName??"",i=t.lastName??"";return`${e}${""!==e?` ${i}`:`${i}`}`},A=t=>t.filter((t=>void 0!==t.consumer&&void 0!==t.rating)).sort(((t,e)=>e.rating-t.rating)).slice(0,10).map((t=>({"@type":w.REVIEW,author:{"@type":w.PERSON,name:y(t.consumer).trim()},datePublished:new Date(t.submittedAt).toISOString().substring(0,10),reviewBody:t.comment,name:t.title,publisher:{"@type":w.ORGANIZATION,name:"Trusted Shops",url:"www.trustedshops.de"},reviewRating:{"@type":w.RATING,bestRating:"5",worstRating:"1",ratingValue:`${t.rating}`}}))),R=t=>({"@type":w.AGGREGATERATING,ratingValue:t.rating.toString(),reviewCount:t.count.toString()}),C=(t,e)=>{const{products:i,grade:n,reviews:s}=t,r=i[0],a=!e||!e.find((t=>!!t.brand)),o=r?.image&&r.image.original?r.image.original.url:void 0;return{"@context":"https://schema.org","@type":w.PRODUCT,"@id":r.sku,aggregateRating:R(n),sku:r.sku,name:r.name,gtin:r.gtin,mpn:r.mpn,brand:r.brand&&a?{"@type":w.BRAND,name:r.brand}:void 0,image:o,review:A(s)}};var L;!function(t){t.OS="os",t.LIGHT="light",t.DARK="dark"}(L||(L={}));const S=L,U="data-key-nav",O=new Map;let _=0;const I=(t,e="")=>t?.getAttribute(U)??e,$=t=>O.get(I(t))??void 0,N=(t,e,...i)=>{const n={element:t,tabIndex:e,callback:new Map([...i])},s=I(t,_.toString());return t?.setAttribute(U,`${s}`),O.set(`${s}`,n),_+=1,n},x=t=>{O.set(I(t.element),t)},D=(t,e=0)=>{t?.setAttribute("tabindex",`${e}`)},B=(t,e)=>{const i=(t=>Number(t?.getAttribute("tabindex")??0))(t);D(t,-1),t.contentEditable="true",t.focus(),D(t,e??i),t.contentEditable="false"},M=(t,e)=>["Enter",()=>{e&&e(),t.click()}],k=(t,e=1,i="over")=>{N(t,e),D(t,e),((t,e)=>{const i=$(t);i&&(i.eventListener=[()=>{t.dispatchEvent(new Event("mouseenter",{bubbles:!0}))},()=>{t.dispatchEvent(new Event("mouseleave",{bubbles:!0}))}],"out"!==e&&t.addEventListener("focus",i.eventListener[0]),"out"!==e&&t.addEventListener("keydown",(t=>{"Tab"===t.key&&t.shiftKey&&i.eventListener[1]()})),"in"!==e&&t.addEventListener("focusout",i.eventListener[1]),"in"!==e&&t.addEventListener("keydown",(t=>{"Tab"===t.key&&t.shiftKey&&i.eventListener[0]()})),x(i))})(t,i)},P=(t,e=1,...i)=>{((t,e,...i)=>{const n=i.length>0?i:[M(t)];N(t,e,...n),D(t,e),(t=>{const e=$(t);if(!e||void 0===e.callback)return;const i=t=>{e.callback?.has(t.key)&&(t=>{try{if(!t)return;return t()}catch(t){console.log("error: ",t)}})(e.callback.get(t.key))};e.eventListener=[()=>{t.addEventListener("keydown",i)},()=>{t.removeEventListener("keydown",i)}],t.addEventListener("focus",e.eventListener[0]),t.addEventListener("focusout",e.eventListener[1]),x(e)})(t)})(t,e,...i)},G=(t,e,i,n="key",s="over")=>{((t,e)=>{let i=Array.from(t.querySelectorAll(e));return 0===i.length&&(i=Array.from(t.shadowRoot?.querySelectorAll(e)??[])),i})(t.element,e).forEach((e=>{"hover"===n?k(e,i,s):P(e,i),t.children=[...t.children??[],I(e,"")]})),x(t)},H=(t,e,i=1,n="over")=>{const s=$(t);s&&G(s,e,i,"hover",n)},F=(t,e,i=1)=>{const n=$(t);n&&G(n,e,i)},j=async(t,e,i,n)=>(t=>{if(!t)return"";return(t=>String(t).replaceAll("'","&#39;"))(t)})(await d(t,e,i,n));var q;let K=q=class extends HTMLElement{data;filter;baseUrl;locale;grade;constructor(t,e){if(super(),this.data=t,this.filter=e,!this.data)return;const{grade:i,baseUrl:n,locale:s}=this.data;this.grade=i,this.baseUrl=n,this.locale=s}async connectedCallback(){this.innerHTML||(await this.render(),P(this,-1),H(this,"a"))}static getPercentageBar(t,e,i,n){const s=q.getHtmlElement("div","","distribution-row");return s.setAttribute("data-filter-value",t.toString()),s.innerHTML=`\n      <span class="rating-index" aria-label="${t}">\n        ${t} <span class="rating-star" aria-label="${n}"><img class="star empty"/></span>\n      </span>\n      <div class="bar" aria-label="${i}">\n        <div class="bar-filled" style="width: ${e}%"></div>\n      </div>\n      <span class="percent"> ${e}% </span>\n    `,s}static getHtmlElement(t,e,...i){const n=document.createElement(t);return n.innerHTML=e,n.classList.add(i.join(" ")),n}async getEmptyHeaderHtml(){return`\n        <div class="rating-distribution">\n          <div class="header">\n            <span class="message">\n              ${await j(this.baseUrl,this.locale,"header.noRatingYet")}\n            </span>\n            <span class="logo" aria-label="${await j(this.baseUrl,this.locale,"common.logoAriaLabel")}>\n            </span>\n          </div>\n        </div>\n      `}async getHeaderHtml(t){const e=await j(this.baseUrl,this.locale,"common.logoAriaLabel"),i=`\n      <span class="rating">\n        ${r(this.locale,this.grade.rating,2,2)}\n      </span>\n      <span class="review-count"> ${t} </span>\n      <span class="logo" aria-label="${e}">\n      </span>`;return q.getHtmlElement("div",i,"header")}async getBodyHtml(t,e){const{oneStar:i,twoStars:n,threeStars:s,fourStars:r,fiveStars:a}=t,o=q.getHtmlElement("div","","body"),l=[i,n,s,r,a].map((t=>{return i=t,n=e,isNaN(i)||0===n?0:Math.round(100*i/n);var i,n})),c=await j(this.baseUrl,this.locale,"rating.barAriaLabel"),d=await j(this.baseUrl,this.locale,"rating.starsText"),h=l.map(((t,e)=>q.getPercentageBar(e+1,t,c,d))).reverse();return this.filter?.addAsFilterElement(h,"stars"),o.append(...h),o}static async getFooterHtml(t,e){const i=`\n      <span>${t}</span>\n      <span>${e}</span>\n    `;return q.getHtmlElement("div",i,"footer")}async render(){this.innerHTML="";const{count:t,distribution:e}=this.grade;if(!(t>0))return void(this.innerHTML=await this.getEmptyHeaderHtml());const i=await j(this.baseUrl,this.locale,"header.totalReviewCount",{totalReviewCount:t.toString()}),n=q.getHtmlElement("div","","rating-distribution"),s=await j(this.baseUrl,this.locale,"common.legalText"),r=await j(this.baseUrl,this.locale,"common.legalText2"),a=await this.getHeaderHtml(i),o=await this.getBodyHtml(e,t),l=await q.getFooterHtml(s,r);n.append(a,o,l),this.innerHTML="",this.append(n)}};K=q=function(t,e,i,n){var s,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(a=(r<3?s(a):r>3?s(e,i,a):s(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a}([h({selector:"etrusted-rating-distribution"})],K);const V=K;class W{stars=new Set;language=new Set;reply=!1;setStars(t){return this.stars.has(t)?this.stars.delete(t):this.stars.add(t),5===this.stars.size&&this.stars.clear(),this}}var X;!function(t){t.STARS="stars",t.REPLY="reply",t.LANGUAGE="language"}(X||(X={}));let z=class extends HTMLElement{reviewListElement;CLOSED_CLASS="closed";OPENED_CLASS="open";opened=!1;baseUrl;locale;grade;theme;filter=new W;filterElements=new Map;mapping;dropdown;eventListener;constructor(t,e){super(),this.reviewListElement=e,this.locale=t.locale,this.baseUrl=t.baseUrl,this.theme=t.theme,this.grade=t.grade,this.mapping=new Map([[5,this.grade.distribution.fiveStars],[4,this.grade.distribution.fourStars],[3,this.grade.distribution.threeStars],[2,this.grade.distribution.twoStars],[1,this.grade.distribution.oneStar]]),this.setAttribute("theme",this.theme)}async connectedCallback(){this.createBaseElement(),this.eventListener=t=>{this.isOutSideClick(t)},window.addEventListener("click",this.eventListener),0!==this.grade.rating&&this.render().then((()=>{P(this,-1),F(this,"li[data-filter-value]",1),F(this,"a",1),(t=>{const e=$(t);if(e&&e.children?.length&&e.children?.length>0){const i=[...e.children].pop(),n=i?O.get(i):void 0;n?.element.addEventListener("keydown",(e=>{"Tab"!==e.key||e.shiftKey||B(t),"Tab"===e.key&&e.shiftKey&&n&&B(n.element)}))}})(this)}))}async disconnectedCallback(){this.dropdown?.remove(),window.removeEventListener("click",this.eventListener)}async isOutSideClick(t){this.contains(t.composedPath()[0])||this.close()}createBaseElement(){this.dropdown=document.createElement("div"),this.dropdown.classList.add("review-filter",this.CLOSED_CLASS)}toggle(t){t.stopPropagation(),this.opened?this.close():this.open()}open(){this.opened=!0,this.dropdown.classList.remove(this.CLOSED_CLASS),this.dropdown.classList.add(this.OPENED_CLASS),B(this.dropdown.firstElementChild,1)}close(){this.opened=!1,this.dropdown.classList.remove(this.OPENED_CLASS),this.dropdown.classList.add(this.CLOSED_CLASS),((t,e)=>{const i=((t,e)=>{const i=$(t)??N(t,e);return i.tabIndex=e,D(i.element,e),x(i),i})(t,e);i.children?.forEach((t=>{const i=O.get(t);i&&(i.tabIndex=e,D(i.element,e),x(i))})),x(i)})(this.firstElementChild,-1)}async resetFilter(){this.filter=new W,await this.reviewListElement.update((async t=>t)),await this.setStarFilter()}addAsFilterElement(t,e,i=X.STARS){this.filterElements.set(e,[...t,...this.filterElements.get(e)??[]]),t.forEach((t=>{t.onclick=e=>{e.stopPropagation(),this.updateFilter(t,i)}}))}async setStarFilter(){this.filterElements.get("stars").forEach((t=>{const e=Number(t.getAttribute("data-filter-value"));this.filter.stars.has(e)?(t.classList.add("active"),t.setAttribute("aria-checked","true")):(t.classList.remove("active"),t.setAttribute("aria-checked","false"))}))}async updateFilter(t,e=X.STARS){const i=t.getAttribute("data-filter-value");if(e===X.STARS){this.filter.setStars(Number(i));const t=this.filterReviews.bind(this);await this.reviewListElement.update(t),await this.setStarFilter()}return this.filter}async filterReviews(t){let e;return this.filter.stars&&this.filter.stars.size>0&&(e=t.filter((t=>this.filter.stars.has(t.rating)))),this.filter.language&&this.filter.language.size>0&&(e=t.filter((t=>this.filter.language.has(t.locale)))),this.filter.reply&&(e=t.filter((t=>t.reply))),e??t}async getDropDown(){const t=await j(this.baseUrl,this.locale,"filter.checkBoxAriaLabel"),e=[...Array(5).keys()].map((e=>{const i=e+1,n=document.createElement("li");return n.setAttribute("data-filter-value",i.toString()),n.setAttribute("role","checkbox"),n.setAttribute("aria-label",`${i} ${t}`),n.setAttribute("aria-checked","false"),n.innerHTML=`\n            <etrusted-rl-star-rating\n              baseurl="${this.baseUrl}"\n              rating="${i}"\n              theme="${this.theme}"\n            ></etrusted-rl-star-rating>\n            <span>\n              (${this.mapping.get(i)})\n            </span>\n      `,n}));this.addAsFilterElement(e,"stars");const i=document.createElement("div");i.classList.add("filter");const n=document.createElement("span");n.innerText=await j(this.baseUrl,this.locale,"filter.header");const s=document.createElement("a");s.innerText=await j(this.baseUrl,this.locale,"filter.removeFilter"),s.onclick=()=>this.resetFilter();const r=document.createElement("ol");return r.classList.add("filter-list"),r.append(...e.reverse()),i.prepend(n),i.append(r),i.append(s),i}async render(){const t=await this.getDropDown(),e=document.createElement("button"),i=await j(this.baseUrl,this.locale,"filter.label"),n=await j(this.baseUrl,this.locale,"filter.showAriaLabel"),s=await j(this.baseUrl,this.locale,"filter.hideAriaLabel");e.innerHTML=`\n      ${i}\n      <span class="icon" aria-label="${n}"></span>\n    `,e.onclick=t=>{this.toggle(t);const i=e.querySelector(".icon");if(i){const t=i.getAttribute("aria-label");i.setAttribute("aria-label",t===n?s:n)}},e.setAttribute("tabIndex","2"),this.dropdown.append(e,t),this.append(this.dropdown)}};z=function(t,e,i,n){var s,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(a=(r<3?s(a):r>3?s(e,i,a):s(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a}([h({selector:"etrusted-review-filter"})],z);const Y=z,Z=(t,e)=>{const i=new Intl.RelativeTimeFormat(t,{numeric:"auto"}),n=new Date,s=new Date(e),r=s.getTime()-n.getTime(),a=Math.trunc(r/1e3),o=Math.abs(a);let l=a,c="second";if(o>=60&&o<3600)l=Math.trunc(a/60),c="minute";else if(o>3600&&o<86400)l=Math.trunc(a/3600),c="hour";else if(o>=86400&&o<604800)l=Math.trunc(a/86400),c="day";else if(o>604800)return s.toLocaleDateString(t);return i.format(l,c)};var J;!function(t){t.CENTER="center",t.LEFT="left",t.RIGHT="right"}(J||(J={}));let Q=class extends HTMLElement{ATTRIBUTE_CONTENT="content";ATTRIBUTE_ORIENTATION="orientation";ATTRIBUTE_BASEURL="baseUrl";ATTRIBUTE_LOCALE="locale";baseUrl;locale;content;orientation;toolTipContainer;async connectedCallback(){this.content=this.getAttribute(this.ATTRIBUTE_CONTENT)||"",this.orientation=this.getAttribute(this.ATTRIBUTE_ORIENTATION)||J.CENTER,this.baseUrl=this.getAttribute(this.ATTRIBUTE_BASEURL)||"",this.locale=this.getAttribute(this.ATTRIBUTE_LOCALE)||"",requestIdleCallback((()=>{this.addEventListener("mouseenter",(()=>{this.open()})),this.addEventListener("mouseleave",(()=>this.close()))}))}disconnectedCallback(){this.removeEventListener("mouseenter",(()=>{this.open()})),this.removeEventListener("mouseleave",(()=>this.close()))}async open(){this.toolTipContainer?this.toolTipContainer.style.display="block":(await this.render(),this.content.includes("<a")?H(this,"a",2,"out"):k(this,2,"out"))}close(){this.toolTipContainer&&(this.toolTipContainer.style.display="none")}setPosition(t){const e=this.children[0];let i;i=this.orientation===J.LEFT?e.getBoundingClientRect().width-t.offsetWidth:0,t.style.left=`${i}px`}getCloseButton=async()=>{const t=await j(this.baseUrl,this.locale,"common.closeAriaLabel"),e=document.createElement("div");return e.setAttribute("aria-label",t),e.classList.add("close"),e.onclick=()=>this.close(),e};async render(){if(this.toolTipContainer=document.createElement("div"),this.toolTipContainer.classList.add("tooltip-wrapper"),this.toolTipContainer.classList.add(this.orientation),this.toolTipContainer.innerHTML=`\n      <div class="tooltip ${this.orientation}">\n        <span tabindex='-1' >${this.content}</span>\n      </div>\n    `,"ontouchstart"in window||navigator.maxTouchPoints>0){const t=await this.getCloseButton();this.toolTipContainer.firstElementChild.appendChild(t)}this.appendChild(this.toolTipContainer),this.setPosition(this.toolTipContainer)}};Q=function(t,e,i,n){var s,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(a=(r<3?s(a):r>3?s(e,i,a):s(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a}([h({selector:"etrusted-rc-tooltip"})],Q);const tt=t=>e=>{customElements.get(t.selector)||customElements.define(t.selector,e)};let et=class extends HTMLElement{ATTRIBUTE_BASE_URL="baseUrl";ATTRIBUTE_LOCALE="locale";locale;baseUrl;ATTRIBUTE_RATING="rating";MIN_GRADE=0;MAX_GRADE=5;translateContent;async connectedCallback(){this.baseUrl=this.getAttribute(this.ATTRIBUTE_BASE_URL)||"",this.locale=this.getAttribute(this.ATTRIBUTE_LOCALE)||"",this.translateContent=d.bind(this,this.baseUrl,this.locale);const t=+(this.getAttribute(this.ATTRIBUTE_RATING)??0);this.validate(t)&&await this.render(t)}validate(t){return!(isNaN(t)||t<this.MIN_GRADE||t>this.MAX_GRADE)}async render(t){const e=Math.floor(t),i=t%1*100,n='<div class="empty"></div>',s='<div class="filled"></div>',r=await this.translateContent("review.ratingAriaLabel",{rating:t.toString()});this.innerHTML=`\n      <div class="star-rating" aria-label="${r}">\n        ${s.repeat(e)}\n        ${e!==this.MAX_GRADE?`\n              <div class="star-rating__fraction">\n                <div class="star">\n                  ${n}\n                </div>\n                <div class="star" style="width: ${i}%">\n                  ${s}\n                </div>\n              </div>\n              ${n.repeat(this.MAX_GRADE-e-1)}\n            `:""}\n      </div>\n    `}};et=function(t,e,i,n){var s,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(a=(r<3?s(a):r>3?s(e,i,a):s(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a}([tt({selector:"etrusted-ig-star-rating"})],et);const it=(t,e,i="lazy",n)=>`<img src="${t}/assets/images/${e}.svg" loading="${i}" ${n?`class="${n}"`:""} />`,nt="data-key-nav",st=new Map;let rt=0;const at=(t,e="")=>t.getAttribute(nt)??e,ot=t=>st.get(at(t))??void 0,lt=(t,e,...i)=>{const n={element:t,tabIndex:e,callback:new Map([...i])},s=at(t,rt.toString());return t.setAttribute(nt,`${s}`),st.set(`${s}`,n),rt+=1,n},ct=t=>{st.set(at(t.element),t)},dt=(t,e=0)=>{t.setAttribute("tabindex",`${e}`)},ht=(t,e)=>{requestAnimationFrame((()=>{const i=(t=>Number(t.getAttribute("tabindex")??0))(t);dt(t,-1),t.contentEditable="true",t.focus(),dt(t,e??i),t.contentEditable="false"}))},ut=(t,e)=>["Enter",()=>{e&&e(),t.click()}],pt=(t,e=1,...i)=>{((t,e,...i)=>{const n=i.length>0?i:[ut(t)];lt(t,e,...n),dt(t,e),(t=>{const e=ot(t);if(!e||void 0===e.callback)return;const i=t=>{e.callback?.has(t.key)&&(t.preventDefault(),t.stopPropagation(),(t=>{try{if(!t)return;return t()}catch(t){console.log("error: ",t)}})(e.callback.get(t.key)))};e.eventListener=[()=>{t.addEventListener("keydown",i)},()=>{t.removeEventListener("keydown",i)}],t.addEventListener("focus",e.eventListener[0]),t.addEventListener("focusout",e.eventListener[1]),ct(e)})(t)})(t,e,...i)},mt=(t,e)=>{let i=Array.from(t.querySelectorAll(e));return 0===i.length&&(i=Array.from(t.shadowRoot?.querySelectorAll(e)??[])),i},gt=(t,e,i=1,...n)=>{const s=ot(t);s&&((t,e,i,n="key",...s)=>{mt(t.element,e).forEach((e=>{"hover"===n?((t,e=1,...i)=>{lt(t,e,...i),dt(t,e),(t=>{const e=ot(t);e&&(e.eventListener=[()=>{t.dispatchEvent(new Event("mouseenter"))},()=>{t.dispatchEvent(new Event("mouseleave"))}],t.addEventListener("focus",e.eventListener[0]),t.addEventListener("focusout",e.eventListener[1]),ct(e))})(t)})(e,i,...s):pt(e,i,...s),t.children=[...t.children??[],at(e,"")]})),ct(t)})(s,e,i,"key",...n)};let vt=class extends HTMLElement{ATTRIBUTE_BASE_URL="baseUrl";ATTRIBUTE_LOCALE="locale";ATTRIBUTE_TABINDEX="data-parent-tabindex";locale;baseUrl;tabindex;wrapperElement;reviewWrapperElement;indicatorElement;dotSlider;slides;observer;referenceElement;_data;currentIndex=0;imageCount=0;translateContent;get data(){return this._data}set data(t){this._data=t,this.imageCount=this._data.review.images.length,this.render().then((()=>{this.initKeyNavigation()}))}connectedCallback(){this.baseUrl=this.getAttribute(this.ATTRIBUTE_BASE_URL)||"",this.locale=this.getAttribute(this.ATTRIBUTE_LOCALE)||"",this.translateContent=d.bind(this,this.baseUrl,this.locale)}disconnectedCallback(){this.unobserveSlideVisibility()}initKeyNavigation(){requestAnimationFrame((()=>{const t=Number(this.getAttribute(this.ATTRIBUTE_TABINDEX)||"1");this.tabindex=t;const e=this.tabindex+1,i=e+1,n=this.wrapperElement.firstElementChild.clientWidth;if(0!==n){if(pt(this,-1),gt(this,"button.close",e),gt(this,".report-button",i),n>=700){const t=".review-wrapper > .thumbnails > img.thumbnail";gt(this,"button.previous",i),gt(this,"button.next",i),gt(this,t,i)}else gt(this,".close-overlay",i),gt(this,".slides",i),gt(this,".review",i),gt(this,"a",i);(t=>{const e=ot(this);if(e&&e.children?.length&&e.children?.length>2){const t=e.children.filter((t=>{const e=st.get(t);return!!e&&"none"!==getComputedStyle(e.element).display})),i=st.get(t.shift()),n=st.get(t.pop());n?.element.addEventListener("keydown",(e=>{"Tab"!==e.key||e.shiftKey||requestAnimationFrame((()=>{ht(i.element)})),"Tab"===e.key&&e.shiftKey&&requestAnimationFrame((()=>{const e=st.get(t.pop());e&&ht(e.element)}))})),i.element.addEventListener("keydown",(t=>{"Tab"===t.key&&t.shiftKey&&n&&ht(n.element)}))}})()}}))}show(t=0,e){var i;e&&(this.referenceElement=e),this.currentIndex=t,this.wrapperElement.classList.add("show"),this.scrollToSlide(this.currentIndex),this.initKeyNavigation(),i=this,requestAnimationFrame((()=>{const t=mt(i,"button.close");if(0===t.length)return;const e=t.filter((t=>"none"!==getComputedStyle(t).display));0!==e.length&&ht(e.shift())}))}hide(){this.wrapperElement.classList.remove("show"),ht(this.referenceElement??this.parentElement)}showOverlay(t){var e;this.reviewWrapperElement.classList.add("overlay"),e=this.reviewWrapperElement.querySelector("button.close-overlay"),ht(e,undefined),e.addEventListener("keydown",(t=>{"Tab"===t.key&&ht(e)})),t.stopPropagation()}hideOverlay(t){this.reviewWrapperElement.classList.remove("overlay"),t.stopPropagation()}scrollToSlide(t=0){const e=this.querySelector(`#slide-${t}`);e&&e.scrollIntoView()}previousSlide(){this.currentIndex=this.currentIndex>0?this.currentIndex-1:this.imageCount-1,this.scrollToSlide(this.currentIndex)}nextSlide(){this.currentIndex=this.currentIndex<this.imageCount-1?this.currentIndex+1:0,this.scrollToSlide(this.currentIndex)}async reportImage(t){const{channel:e,review:i}=this.data,n=i.id,s=new Date(i.date).toLocaleString("en-GB").substring(0,10),r=await this.translateContent("report.body"),a="-".repeat(40),o=e?`${e.tsId} / ${n} / ${t.id} / ${e.name}`:`${n} / ${t.id}`,l=`${t.url}\n${i.comment||""}`,c=`${i.rating}/5 - ${s}`,d=await this.translateContent("report.subject",{imageId:t.id}),h=`${r}\n\n${a}\n${o}\n\n${l}\n\n${c}`;window.open(`mailto:reviewservice@trustedshops.com?subject=${d}&body=${encodeURIComponent(h)}`)}observeSlideVisibility(){this.slides=this.querySelectorAll(".slide"),this.observer=new IntersectionObserver((t=>{t.forEach((t=>{t.intersectionRatio>=.5&&(this.currentIndex=+t.target.id.split("-")[1],this.updateIndicator(this.currentIndex),this.updateThumbnailStyle(this.currentIndex),this.updateDotSlider(this.currentIndex))}))}),{threshold:.5}),this.slides.forEach((t=>{this.observer.observe(t)}))}unobserveSlideVisibility(){this.slides.forEach((t=>{this.observer.unobserve(t)})),this.observer.disconnect()}async updateIndicator(t=0){this.indicatorElement.innerHTML=await this.translateContent("gallery.of",{current:(t+1).toString(),total:this.imageCount.toString()})}updateDotSlider(t=0){Array.from(this.dotSlider.children).forEach(((e,i)=>{e.classList.remove("dot-highlighted"),i===t&&e.classList.add("dot-highlighted")}))}updateThumbnailStyle(t=0){this.querySelectorAll(".thumbnail").forEach(((e,i)=>{e.classList.remove("active"),i===t&&(e.classList.add("active"),e.scrollIntoView())}))}async getImageSlider(){const{images:t}=this.data.review,e=await this.translateContent("gallery.leftChevronAriaLabel"),i=await this.translateContent("gallery.rightChevronAriaLabel"),n=await this.translateContent("gallery.imageAltText");return`<div class="image-slider">\n      <button\n        type="button"\n        class="previous navigation mobile-hide"\n        onclick="this.parentNode.parentNode.parentNode.parentNode.parentNode.previousSlide()"\n        aria-label="${e}"\n      >\n        ${it(this.baseUrl,"chevron-left")}\n      </button>\n      <div class="slides">\n        ${t.map(((t,e)=>`<img id="slide-${e}" class="slide" src="${t.url}" alt="${n} ${e+1}"/>`)).join("")}\n      </div>\n      <button\n        type="button"\n        class="next navigation mobile-hide"\n        onclick="this.parentNode.parentNode.parentNode.parentNode.parentNode.nextSlide()"\n        aria-label="${i}"\n      >\n        ${it(this.baseUrl,"chevron-right")}\n      </button>\n    </div>`}async getReview(){const{title:t,comment:e,consumer:i,rating:n,date:s,isVerified:r}=this.data.review,a=await this.translateContent("review.noUserComment"),o=await this.translateContent("review.writtenBy"),l=await this.translateContent("review.verified"),c=await this.translateContent("imported.long"),d=await this.translateContent("review.readMore"),h=!!t||!!e,u=i&&i.firstName,p=!!t&&!((t,e)=>!(!t||!e)&&t.startsWith(e?.substring(0,e.length-3)))(e,t);return`<div class="review" onclick="event.stopPropagation()">\n      <div class="row justify-center sticky-top close-overlay-wrapper">\n        <div class="col-auto">\n          <button type="button" class="close-overlay">\n            <div class="close-icon">&#x2715;</div>\n          </button>\n        </div>\n      </div>\n      <div\n        class="header"\n        onclick="this.parentNode.parentNode.parentNode.parentNode.parentNode.showOverlay(event)"\n      >\n        <div class="row align-center">\n          <div class="col rating">\n            <etrusted-ig-star-rating\n              rating="${n}"\n              baseUrl="${this.baseUrl}"\n              locale="${this.locale}"\n            ></etrusted-ig-star-rating>\n          </div>\n          ${r?`<div class="col-auto verified">\n                  <span></span> ${l}\n                </div>`:`<div class="col-auto imported">\n                  ${c}\n                </div>`}\n        </div>\n        <div class="row">\n          <div class="col relative-time">\n            ${((t,e)=>{const i=new Intl.RelativeTimeFormat(t,{numeric:"auto"}),n=new Date,s=new Date(e),r=s.getTime()-n.getTime(),a=Math.trunc(r/1e3),o=Math.abs(a);let l=a,c="second";if(o>=60&&o<3600)l=Math.trunc(a/60),c="minute";else if(o>3600&&o<86400)l=Math.trunc(a/3600),c="hour";else if(o>=86400&&o<604800)l=Math.trunc(a/86400),c="day";else if(o>604800)return s.toLocaleDateString(t);return i.format(l,c)})(this.locale,s)}\n            ${u?`${o} ${i?.firstName||""}\n            ${i?.lastName||""}`:""}\n          </div>\n          <a class="col-auto mobile-show read-more">${d}</a>\n        </div>\n      </div>\n      <div class="row content mobile-hide">\n        <div class="col">\n          ${h?`\n              ${p?`<div class="title">${t||""}</div>`:""}\n              <div class="comment">${e||""}</div>\n            `:`<div class="disclaimer">${a}</div>`}\n        </div>\n      </div>\n    </div>`}async getThumbnails(){const{images:t}=this.data.review,e=await this.translateContent("gallery.imageAltText");return`<div class="thumbnails mobile-hide">\n      ${t.map(((t,i)=>`<img\n            class="thumbnail"\n            src="${t.url}"\n            alt="${e} ${i+1}"\n            onclick="this.parentNode.parentNode.parentNode.parentNode.parentNode.scrollToSlide(${i})"\n          />`)).join("")}\n    </div>`}async getInformationBar(){const t=await this.translateContent("gallery.closeAriaLabel"),e=await this.translateContent("gallery.reportAriaLabel"),i=await this.translateContent("report.link");return` <div class="information-bar row align-center">\n      <div class="col">\n        <button type="button" class="close mobile-show" aria-label="${t}">\n          <div class="close-icon">&#x2715;</div>\n        </button>\n      </div>\n      <div class="col text-center indicator">\n        ${this.currentIndex+1} of ${this.imageCount}\n      </div>\n      <div class="col">\n        <div class="row justify-right">\n          <div class="col-auto">\n            <a class="report-button" href="javascript:void(0)" aria-label="${e}">\n              <span class="mobile-hide"> ${i} </span>\n              <span class="report-icon mobile-show">\n              </span>\n            </a>\n          </div>\n        </div>\n      </div>\n    </div>`}async render(){const t=await this.translateContent("gallery.closeAriaLabel");this.innerHTML=`\n      <div class="modal-wrapper" onclick="this.parentNode.hide()">\n        <div class="modal row" onclick="event.stopPropagation()">\n          <div class="gallery-wrapper">\n            ${await this.getImageSlider()}\n            <div class="dot-slider mobile-show">\n              ${'<span class="dot"></span>'.repeat(this.imageCount)}\n            </div>\n            ${await this.getInformationBar()}\n          </div>\n          <div class="review-wrapper">\n            <div class="row justify-right mobile-hide">\n              <div class="col-auto">\n                <button  type="button" class="close">\n                  <div class="close-icon" aria-label="${t}"></div>\n                </button>\n              </div>\n            </div>\n            ${await this.getReview()}\n            ${await this.getThumbnails()}\n          </div>\n        </div>\n      </div>\n    `;const e=this.querySelector(".modal-wrapper");e&&(this.wrapperElement=e);const i=this.querySelector(".indicator");i&&(this.indicatorElement=i);const n=this.querySelector(".review-wrapper");n&&(this.reviewWrapperElement=n,this.reviewWrapperElement.onclick=t=>this.hideOverlay(t));const s=this.querySelector(".dot-slider");s&&(this.dotSlider=s);const r=this.querySelector(".report-button");r&&(r.onclick=()=>this.reportImage(this.data.review.images[this.currentIndex])),this.querySelectorAll(".close").forEach((t=>t.onclick=()=>this.hide()));const a=this.querySelector(".close-overlay");a&&(a.onclick=t=>this.hideOverlay(t)),this.observeSlideVisibility()}};vt=function(t,e,i,n){var s,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(a=(r<3?s(a):r>3?s(e,i,a):s(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a}([tt({selector:"etrusted-ig-modal"})],vt);let Tt=class extends HTMLElement{alwaysUpdate;outsideModal;ATTRIBUTE_LOCALE="data-locale";ATTRIBUTE_BASE_URL="data-base-url";ATTRIBUTE_ACCENT_COLOR="data-accent-color";ATTRIBUTE_TABINDEX="tabindex";PAGE_SIZE=4;locale;baseUrl;tabindex;modalElement;rootElement;_data;initialRender=!1;get data(){return this._data}set data(t){this._data=t,this.render()}constructor(t=!1,e){super(),this.alwaysUpdate=t,this.outsideModal=e}connectedCallback(){if(!this.initialRender){this.locale=this.getAttribute(this.ATTRIBUTE_LOCALE)||"",this.baseUrl=this.getAttribute(this.ATTRIBUTE_BASE_URL)||"",this.tabindex=this.getAttribute(this.ATTRIBUTE_TABINDEX)||"1",this.translateContent=d.bind(this,this.baseUrl,this.locale);const t=this.getAttribute(this.ATTRIBUTE_ACCENT_COLOR)||"";if(!this.locale||!this.baseUrl)throw new Error("'data-locale' and 'data-base-url' need to be provided");this.attachShadow({mode:"open"}),this.rootElement=this.addRootElement(),this.addCssStyle(this.baseUrl),this.changeAccentColor(t),this.render(),pt(this,Number(this.tabindex),["Enter",()=>this.showModal(0,this)])}this.initialRender=!this.alwaysUpdate}showModal(t,e){this.modalElement.show(t,e)}translateContent;changeAccentColor(t){t&&this.style.setProperty("--accent-color",t)}addCssStyle(t){const e=document.createElement("style");e.setAttribute("type","text/css"),e.innerHTML=`@import "${t}/index.css"`,this.shadowRoot?.appendChild(e)}addRootElement(){const t=document.createElement("div");return t.classList.add("widget-image-gallery"),t.style.height="4.25em",t.style.display="flex",t.style.overflow="hidden",t.style.gap="0.5em",t.style.fontFamily="Helvetica, arial, sans-serif",t.style.fontSize="0.875em",this.shadowRoot?.appendChild(t),t}async render(){if(!this.data)return;const{review:t}=this.data,{images:e}=t,i=e.length>=this.PAGE_SIZE;let n="gallery.imageAltText",s="gallery.showMoreAriaLabel";try{n=await this.translateContent(n),s=await this.translateContent(s)}catch(t){}this.rootElement.innerHTML=`\n      ${e.slice(0,this.PAGE_SIZE).map(((t,e)=>`<img\n              style="height:100%"\n              class="thumbnail"\n              src="${t.url}"\n              loading="lazy"\n              onclick="this.getRootNode().host.showModal(${e})"\n              alt="${n} ${e+1}"\n            />`)).join("")}\n      ${i?`<div class="remaining-count" onclick="this.getRootNode().host.showModal(0)">\n              <div aria-label="${s}">+${e.length-this.PAGE_SIZE}</div>\n            </div>`:""}\n    `,this.modalElement||(this.outsideModal?this.modalElement=this.outsideModal:(this.modalElement=document.createElement("etrusted-ig-modal"),this.modalElement.setAttribute("baseUrl",this.baseUrl),this.modalElement.setAttribute("locale",this.locale),this.modalElement.setAttribute("data-parent-tabindex",this.tabindex))),this.outsideModal||this.rootElement.append(this.modalElement),this.modalElement.data={review:this.data.review}}};Tt=function(t,e,i,n){var s,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(a=(r<3?s(a):r>3?s(e,i,a):s(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a}([tt({selector:"etrusted-widget-image-gallery"})],Tt);var Et;let bt=Et=class extends HTMLElement{productReview;channelName;baseUrl;locale;showUGC;theme;fontStyle;accentColor;activeOSTheme;constructor(t,e,i,n,s,r,a,o,l){super(),this.productReview=t,this.channelName=e,this.baseUrl=i,this.locale=n,this.showUGC=s,this.theme=r,this.fontStyle=a,this.accentColor=o,this.activeOSTheme=l,this.setAttribute("theme",this.theme)}async connectedCallback(){const t=await j(this.baseUrl,this.locale,"review.writtenBy"),e=await j(this.baseUrl,this.locale,"review.replyFrom"),i=await j(this.baseUrl,this.locale,"review.verifiedInfo",{channelName:this.channelName});this.productReview&&this.render(this.productReview,this.locale,this.baseUrl,this.theme,t,e,i).then((()=>{P(this,-1),H(this,"etrusted-rc-tooltip",2,"in")}))}static commentStartsWithTitle(t,e){return!(!t||!e)&&t.startsWith(e?.substring(0,e.length-3))}getGalleryElement(){const{locale:t,baseUrl:e,showUGC:i,theme:n,activeOSTheme:s,fontStyle:r,accentColor:a}=this,o=this.productReview.attachments?.images;return o&&0!==o.length&&i?`\n      <etrusted-widget-image-gallery\n        id="gallery-${this.productReview.id}"\n        data-locale="${t}"\n        data-base-url="${e}"\n        data-theme="${n===S.OS?s:n}"\n        data-font-style="${r}"\n        data-accent-color="${a}"\n        tabIndex="2"\n      >\n      </etrusted-widget-image-gallery>\n    `:""}async getReplyElement(t,e,i,n){if(!i)return"";const s=await j(e,t,"review.replyEdited");return`\n      <div class="reply">\n        <div class="icon"></div>\n        <div class="title">${n} ${this.channelName}</div>\n        <div class="date">\n          ${Z(t,i.addedAt)}${i.editedAt?` - ${s}`:""}\n        </div>\n        <div class="marker"></div>\n        <div class="comment">${i.comment}</div>\n      </div>\n    `}async render({rating:t,editedAt:e,submittedAt:i,transactionDate:n,consumer:s,title:r,comment:a,reply:o,isVerified:l},c,d,h,u,p,m){const g=!!r||!!a,v=s&&s.firstName,T=p&&o,E=this.productReview.attachments?.images,b=!!r&&!Et.commentStartsWithTitle(a,r),f=await j(d,c,"imported.short"),w=Z(c,e||i),y=await j(d,c,"dateTooltip.submission"),A="<br />"+await j(d,c,"dateTooltip.transaction")+" "+(n?Z(c,n):w);this.innerHTML=`\n      <div class="review">\n        <div class="header">\n          <div class="row row--space-between">\n            <etrusted-rl-star-rating\n              baseurl="${d}"\n              rating="${t}"\n              theme="${h}"\n            ></etrusted-rl-star-rating>\n            ${l?`<etrusted-rc-tooltip content='${m}' orientation="left">\n                    <div class="verified-icon"></div>\n                    </etrusted-rc-tooltip>`:`<div class="imported-flag">\n                    ${f}\n                  </div>`}\n          </div>\n          <div class="row">\n            <etrusted-rc-tooltip content="${y} ${w} ${A}">\n                <span>${Z(c,e||i)}</span>\n            </etrusted-rc-tooltip>\n            ${v?`<div class="consumer">\n                  ${u} ${s?.firstName||""} ${s?.lastName||""}\n                  </div>`:""}\n\n          </div>\n        </div>\n        ${E||g||T?`<div class="body">\n          ${g?`\n                  ${b?`<div class="title">${r||""}</div>`:""}\n                  <div class="comment">${a||""}</div>\n                `:""}\n          ${this.getGalleryElement()}\n          ${await this.getReplyElement(c,d,o,p)}\n        </div>`:""}\n      </div>`;const R=this.querySelector(`#gallery-${this.productReview.id}`);if(R){const t=this.productReview;R.data={review:{...t,date:t.editedAt||t.submittedAt,images:t.attachments?.images.map((t=>({id:t.id,url:t.original.url})))||[]}}}}};bt=Et=function(t,e,i,n){var s,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(a=(r<3?s(a):r>3?s(e,i,a):s(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a}([h({selector:"etrusted-review-element"})],bt);const ft=bt;let wt=class extends HTMLElement{data;PAGE_SIZE=3;pageTotal=this.PAGE_SIZE;constructor(t){super(),this.data=t}async connectedCallback(){await this.render(this.data.reviews)}async update(t){const e=await t(this.data.reviews);this.pageTotal=this.PAGE_SIZE,await this.render(e)}loadMore(t){this.pageTotal+=this.PAGE_SIZE,this.render(t)}showLess(t){this.pageTotal=this.PAGE_SIZE,this.render(t)}async render(t){if(!this.data||0===this.data.grade.count)return;const{baseUrl:e,locale:i,channel:n,theme:s,fontStyle:r,showUGC:a,activeOSTheme:o,accentColor:l}=this.data,c=await j(e,i,"reviewList.noMoreReviews"),d=await j(e,i,"reviewList.loadMore"),h=await j(e,i,"reviewList.showLess"),u=!!t&&t.length>this.PAGE_SIZE,p=t.length>this.pageTotal,m=document.createElement("div");if(m.classList.add("footer"),p){const e=document.createElement("button");e.classList.add("action","load-more"),e.innerText=d,e.onclick=()=>this.loadMore(t),m.appendChild(e),D(e,2),P(e,2,["Enter",()=>{this.loadMore(t),setTimeout((()=>{(t=>{const e=$(t)?.children;if(!e||0===e.length)return;const i=O.get(e.pop()).element;i&&B(i)})(this.firstElementChild.firstElementChild.children[this.pageTotal-this.PAGE_SIZE-1])}),100)}])}else{const e=document.createElement("button"),i=document.createElement("span");i.innerText=c,e.classList.add("action","show-less"),e.innerText=h,e.onclick=()=>this.showLess(t),i.appendChild(e),m.appendChild(i),D(e,2)}this.innerHTML='\n      <div class="review-list">\n        <div class="body"></div>\n      </div>\n    ';const g=this.querySelector(".review-list");u&&g?.appendChild(m);const v=this.querySelector(".body");t.slice(0,this.pageTotal).forEach((t=>{v.appendChild(new ft(t,n.name,e,i,a,s,r,l,o))}))}};wt=function(t,e,i,n){var s,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(a=(r<3?s(a):r>3?s(e,i,a):s(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a}([h({selector:"etrusted-review-list"})],wt);const yt=wt;var At;!function(t){t.DEFAULT="default",t.INHERIT="inherit"}(At||(At={}));const Rt=At;let Ct=class extends HTMLElement{ATTRIBUTE_RATING="rating";MIN_GRADE=0;MAX_GRADE=5;async connectedCallback(){const t=+(this.getAttribute(this.ATTRIBUTE_RATING)??0);this.validate(t)&&this.render(t)}validate(t){return!(isNaN(t)||t<this.MIN_GRADE||t>this.MAX_GRADE)}render(t){const e=Math.floor(t),i=t%1*100,n='<div class="empty"></div>',s='<div class="filled"></div>';this.innerHTML=`\n      <div class="star-rating">\n        ${s.repeat(e)}\n        ${e!==this.MAX_GRADE?`\n              <div class="star-rating__fraction">\n                <div class="star">\n                  ${n}\n                </div>\n                <div class="star" style="width: ${i}%">\n                  ${s}\n                </div>\n              </div>\n              ${n.repeat(this.MAX_GRADE-e-1)}\n            `:""}\n      </div>\n    `}};Ct=function(t,e,i,n){var s,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(a=(r<3?s(a):r>3?s(e,i,a):s(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a}([h({selector:"etrusted-rl-star-rating"})],Ct);let Lt=class extends HTMLElement{ATTRIBUTE_BASE_URL="baseUrl";ATTRIBUTE_LOCALE="locale";ATTRIBUTE_THEME="data-theme";ATTRIBUTE_ACCENT_COLOR="data-accent-color";DEFAULT_ACCENT_COLOR="#DB6B22";DEFAULT_ACCENT_COLOR_DARK_MODE="#FF8700";baseUrl;locale;theme;accentColor;rootElement;_data;get data(){return this._data}set data(t){this._data=t,this.render()}connectedCallback(){this.baseUrl=this.getAttribute(this.ATTRIBUTE_BASE_URL)||".",this.locale=this.getAttribute(this.ATTRIBUTE_LOCALE)||"en-GB",this.theme=this.getAttribute(this.ATTRIBUTE_THEME)||S.DARK,this.accentColor=this.getAttribute(this.ATTRIBUTE_ACCENT_COLOR)||"",this.shadowRoot||(this.attachShadow({mode:"open"}),this.addCssStyle(this.baseUrl),this.rootElement=this.addRootElement(),this.changeAccentColor(),P(this,0))}getNormalizedAccentColor(t=this.DEFAULT_ACCENT_COLOR,e){const i=t===(this.DEFAULT_ACCENT_COLOR||this.DEFAULT_ACCENT_COLOR_DARK_MODE),n=e??this.theme;return i?n===S.DARK?this.DEFAULT_ACCENT_COLOR_DARK_MODE:this.DEFAULT_ACCENT_COLOR:t}addCssStyle(t){const e=document.createElement("style");e.setAttribute("type","text/css"),e.innerHTML=`@import "${t}/index.css"`,this.shadowRoot?.appendChild(e)}addRootElement(){const t=document.createElement("div");return t.classList.add("star-extension"),this.shadowRoot?.appendChild(t),t}changeAccentColor(){const t=this.getNormalizedAccentColor(this.accentColor||this.DEFAULT_ACCENT_COLOR);this.style.setProperty("--accent-color",t)}render(){const{grade:t}=this.data,e=0===t.count?"":`\n          <span class="grade"> ${r(this.locale,t.rating,2,2)} </span>\n          <span class="count"> (${r(this.locale,t.count)}) </span>\n        `;this.rootElement.innerHTML=`\n      <div class="wrapper">\n        <etrusted-rl-star-rating\n          rating="${t.rating}"\n          theme="${this.theme}"\n        ></etrusted-rl-star-rating>\n        ${e}\n      </div>\n    `}};Lt=function(t,e,i,n){var s,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(a=(r<3?s(a):r>3?s(e,i,a):s(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a}([h({selector:"etrusted-star-extension"})],Lt),i(426);var St;let Ut=St=class extends HTMLElement{CURRENT_MAJOR_VERSION="v1";QUERY_SELECTOR_PROPS='script[type="text/props"]';ATTRIBUTE_LOCALE="data-etrusted-locale";ATTRIBUTE_THEME="data-theme";ATTRIBUTE_FONT_STYLE="data-font-style";ATTRIBUTE_UGC="data-ugc";ATTRIBUTE_SKU="data-sku";ATTRIBUTE_GTIN="data-gtin";ATTRIBUTE_MPN="data-mpn";ATTRIBUTE_ACCENT_COLOR="data-accent-color";DEFAULT_ACCENT_COLOR="#DB6B22";DEFAULT_ACCENT_COLOR_DARK_MODE="#FF8700";LAYOUT_BREAKPOINT_PX=700;rootElement;context;visibilityObserver;ratingDistribution;reviewList;placeholders;osThemeHost=window.matchMedia("(prefers-color-scheme: dark)");sortedSkus;intersectionObserver;themeListener=t=>{this.setToOsStyle(t.matches)};async connectedCallback(){const t=this.getRootNode()?.host||this,e=this.getAttribute(this.ATTRIBUTE_LOCALE),i=this.getManifest(),n=this.getAttribute(this.ATTRIBUTE_THEME),s=this.getAttribute(this.ATTRIBUTE_FONT_STYLE),r=this.getAttribute(this.ATTRIBUTE_ACCENT_COLOR)||"",a=this.getAttribute(this.ATTRIBUTE_UGC),o="true"===a;if(!i)return;const l=await this.getBaseUrl(i.application.url),c=St.getDistributionUrl(i.application.url||l),d=this.getAttribute(this.ATTRIBUTE_SKU)?.split(","),h=this.getAttribute(this.ATTRIBUTE_GTIN)?.split(","),u=this.getAttribute(this.ATTRIBUTE_MPN)?.split(","),p=new g(d,h,u);if(this.shadowRoot)return;this.attachShadow({mode:"open"}),this.addCssStyle(l),this.rootElement=this.addRootElement();const f=await T(i.configuration.url),y=await T(i.feeds.channels.url),A=St.getTrackingQueryString(i.id,y.id,f.showUGC),R=i.dynamicFeeds.gtin_mapping?i.dynamicFeeds.gtin_mapping.url:`${c}/feeds/mappings/gtin/v1/channels/${y.id}/${v}/mapping.json`,L=p.getType()===m.GTIN?await(async(t,e)=>{if(e.getType()!==m.GTIN)throw new Error("Product Identifier needs to be GTIN");const i=await Promise.all(e.getIdentifiers().map((e=>(async(t,e)=>{try{return await E(t,m.GTIN,e)}catch{return}})(t,e)))),n=i.filter((t=>!!t)).filter((t=>!!t)).map((t=>t.products.map((t=>t.sku)))).flat();return new g(n)})(R,p):p,U=await(async(t,e)=>{const i=e.getType(),n=e.getEncodedIdentifiers();return(t=>{const e=new Set;return t.filter((t=>{const i=t.id;return!e.has(i)&&(e.add(i),!0)}))})((await Promise.all(n.map((async e=>{try{return await E(t,i,e)}catch{return}})))).filter((t=>!!t)))})(i.dynamicFeeds.products.url,L),O=new g(U.map((t=>t.sku)),void 0,void 0),_=await(async(t,e,i)=>{const n=e.getType(),s=e.getEncodedIdentifiers();return(await Promise.all(s.map((async e=>{try{return await E(t,n,e,i)}catch{return[]}})))).flatMap((t=>t)).sort(((t,e)=>((t,e)=>{const i=new Date(t.editedAt||t.submittedAt),n=new Date(e.editedAt||e.submittedAt);return i.getTime()<n.getTime()?-1:i.getTime()>n.getTime()?1:0})(e,t)))})(i.dynamicFeeds.product_reviews.url,O,A),I=await(async(t,e)=>{const i=e.getType(),n=e.getCombinedIdentifier();if(i!==m.SKU)throw new Error("Unsupported product identifier type");return(await Promise.all(n.map((async e=>{try{return{sku:e.identifier,feed:await E(t,i,e.encoded)}}catch{return}})))).filter((t=>t&&!!t.feed))})(i.dynamicFeeds.grades.url,O),$=I.sort(((t,e)=>t.feed.grades.overall.count-e.feed.grades.overall.count)),N=(t=>{let e=[0,0,0,0,0],i=0,n=0;t.length>0&&(e=b.map((e=>t.map((({distribution:t})=>t[e])).reduce(((t,e)=>e+t),0))),i=t.map((t=>t.count)).reduce(((t,e)=>e+t),0),n=e.reduce(((t,e,i)=>e*(i+1)+t),0)/i);const[s,r,a,o,l]=e;return{count:i,distribution:{fiveStars:l,fourStars:o,threeStars:a,twoStars:r,oneStar:s},rating:n}})($.map((t=>t.feed.grades.overall)));this.sortedSkus=$.map((t=>t.sku)),this.context={baseUrl:l,manifest:i,showUGC:(a?o:f.showUGC)||!1,configuration:{...f,locale:e||f.locale},fontStyle:s||f.fontStyle||Rt.DEFAULT,accentColor:r||f.accentColor||this.DEFAULT_ACCENT_COLOR,theme:n||f.theme||S.LIGHT,channel:y,products:U,reviews:_,grade:N},f.hideWhenEmpty&&0===N.rating||(f.isRichSnippetEnabled&&((t,e)=>{const{products:i,grade:n}=e,s=(t=>{const e=t.map((t=>Array.from(t.childNodes).map((t=>t)).filter((t=>"SCRIPT"===t.nodeName&&t.outerHTML.match(/application\/ld\+json/))).map((t=>{try{return JSON.parse(t.innerHTML)}catch{return{}}})))).flat(),i=e.filter((t=>Array.isArray(t))),n=e.filter((t=>Array.isArray(t["@graph"]))).map((t=>t["@graph"])).flat(),s=e.filter((t=>t["@type"]==w.PRODUCTGROUP)),r=s.map((t=>t.hasVariant)).flat();return[...s,...e,...i,...n,...r].filter((t=>[w.PRODUCT,w.PRODUCTGROUP].includes(t["@type"])))})(t);if(s.filter((t=>t["@type"]==w.PRODUCT&&t.aggregateRating)).length>0)return;if(0===i.length)return;if(0===n.count||0===n.rating)return;const r=s.find((t=>!!t["@id"])),a=r?((t,e,i)=>{const n=C(t,i);return e["@id"]&&(n["@id"]=e["@id"]),n})(e,r,s):C(e,s),o=document.createElement("script");o.setAttribute("type","application/ld+json"),o.appendChild(document.createTextNode(JSON.stringify(a))),t[0].appendChild(o)})([document.head,document.body],{grade:N,reviews:_,products:U}),await this.render(),this.changeAccentColor(this.context.accentColor),this.setAttribute("tabIndex","0"),this.setAttribute(this.ATTRIBUTE_THEME,this.context.theme),this.setAttribute(this.ATTRIBUTE_FONT_STYLE,this.context.fontStyle),this.renderExtensions(),this.updateDisplayStyle(),this.observeVisibility(),this.intersectionObserver=new IntersectionObserver(this.updateDisplayStyle,{root:t.parentElement,rootMargin:"0px",threshold:1}),this.intersectionObserver.observe(this),window.addEventListener("resize",this.updateDisplayStyle,!0),this.setupMutationObserver(t),this.handleOSStyleListener(this.context.theme!==S.OS))}disconnectedCallback(){window.removeEventListener("resize",this.updateDisplayStyle,!0),this.visibilityObserver?.unobserve(this),this.visibilityObserver?.disconnect(),this.visibilityObserver=void 0,this.intersectionObserver?.unobserve(this),this.intersectionObserver?.disconnect(),this.intersectionObserver=void 0,this.handleOSStyleListener(!0)}getNormalizedAccentColor(t=this.DEFAULT_ACCENT_COLOR,e){const i=t.toLowerCase()===this.DEFAULT_ACCENT_COLOR.toLowerCase()||t.toLowerCase()===this.DEFAULT_ACCENT_COLOR_DARK_MODE.toLowerCase(),n=e??this.context.theme;return i?n===S.DARK?this.DEFAULT_ACCENT_COLOR_DARK_MODE:this.DEFAULT_ACCENT_COLOR:t}changeAccentColor(t){const e=this.getNormalizedAccentColor(t);this.context.accentColor=e,this.style.setProperty("--accent-color",e),this.renderExtensions(),this.render()}static getTrackingQueryString(t,e,i){return i?"?"+[["widgetId",t],["channelId",e],["showUGC",i]].map((t=>t.join("="))).join("&"):""}setupMutationObserver(t){const e=new MutationObserver((async e=>{t!==this&&(e.forEach((e=>{const i=e.attributeName,n=t.getAttribute(i);if(i===this.ATTRIBUTE_THEME){const t=this.context.theme;this.context.theme=n??this.context.configuration.theme,this.setAttribute(this.ATTRIBUTE_THEME,n),this.handleOSStyleListener(S.OS===t||S.OS!==this.context.theme),this.changeAccentColor(this.getAttribute(this.ATTRIBUTE_ACCENT_COLOR)??this.context.accentColor)}if(i===this.ATTRIBUTE_LOCALE&&(this.context.configuration.locale=n,this.setAttribute(this.ATTRIBUTE_LOCALE,n)),i===this.ATTRIBUTE_FONT_STYLE&&(this.context.fontStyle=n,this.setAttribute(this.ATTRIBUTE_FONT_STYLE,n)),i===this.ATTRIBUTE_ACCENT_COLOR&&(this.context.accentColor=n,this.setAttribute(this.ATTRIBUTE_ACCENT_COLOR,n),this.changeAccentColor(n)),i===this.ATTRIBUTE_UGC){const t="true"===n;this.context.showUGC=t,this.setAttribute(this.ATTRIBUTE_UGC,n)}})),await this.render(),this.renderExtensions())}));return e.observe(t,{attributes:!0}),e}setToOsStyle=t=>{this.context.activeOSTheme=t?"dark":"light",this.setAttribute(this.ATTRIBUTE_THEME,this.context.activeOSTheme)};handleOSStyleListener(t=!1){if(this.context?.theme){if(this.context.theme===S.OS||!t)return this.setToOsStyle(this.osThemeHost.matches),void this.osThemeHost.addEventListener("change",this.themeListener);this.osThemeHost.removeEventListener("change",this.themeListener)}}observeVisibility(){this.visibilityObserver=new IntersectionObserver((()=>{this.updateDisplayStyle()}),{root:document.documentElement}),this.visibilityObserver.observe(this)}getManifest=()=>{const t=this.querySelector(this.QUERY_SELECTOR_PROPS)?.textContent;return t?JSON.parse(t).manifest:null};addCssStyle(t){const e=document.createElement("style");e.setAttribute("type","text/css"),e.innerHTML=`@import "${t}/index.css"`,this.shadowRoot?.appendChild(e)}addRootElement(){const t=document.createElement("div");return t.classList.add("product-review-list-widget"),this.shadowRoot?.appendChild(t),t}async getBaseUrl(e){if(!e)return".";const i=await t(`${e}/LATEST_VERSION`);return e.replace(this.CURRENT_MAJOR_VERSION,i.trim())||"."}static getDistributionUrl(t){return t&&"."!==t?new URL(t).origin:t}updateDisplayStyle=()=>{setTimeout((()=>{const t=this.shadowRoot?.querySelector(".product-review-list-widget");t&&(t.offsetWidth<this.LAYOUT_BREAKPOINT_PX?t.classList.add("product-review-list-widget--vertical"):t.classList.remove("product-review-list-widget--vertical"))}))};renderExtensions=()=>{const{baseUrl:t,configuration:e,grade:i}=this.context;if(this.placeholders=document.querySelectorAll("etrusted-product-review-list-widget-product-star-extension"),this.placeholders&&this.placeholders.length>0){const n=document.createElement("etrusted-star-extension");n.setAttribute("baseUrl",t),n.setAttribute("locale",e.locale),n.setAttribute(this.ATTRIBUTE_FONT_STYLE,this.context.fontStyle),n.setAttribute(this.ATTRIBUTE_THEME,this.getAttribute(this.ATTRIBUTE_THEME)),n.setAttribute(this.ATTRIBUTE_ACCENT_COLOR,this.context.accentColor||this.DEFAULT_ACCENT_COLOR),n.onclick=()=>this.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),this.placeholders.forEach((t=>{t.innerHTML="",t.appendChild(n)})),n.data={grade:i}}};async render(){if(!this.shadowRoot)return;this.rootElement.innerHTML="";const{baseUrl:t,configuration:e,grade:i,channel:n,reviews:s,theme:r,fontStyle:a,showUGC:o,activeOSTheme:l,accentColor:c}=this.context,d=e.locale,h=document.createElement("div");h.classList.add("col-40");const u=document.createElement("div");u.classList.add("col-60"),this.reviewList=new yt({baseUrl:t,locale:d,channel:n,grade:i,reviews:s,showUGC:o,theme:r,fontStyle:a,accentColor:c,activeOSTheme:l});const p=new Y({baseUrl:t,locale:d,theme:r,grade:i},this.reviewList);this.sortedSkus,this.ratingDistribution=new V({baseUrl:t,locale:d,channel:n,grade:i,theme:r});const m=document.createElement("div");m.classList.add("bar");const g=document.createElement("div");g.classList.add("bar-action");const v=document.createElement("div");v.classList.add("bar-content"),g.append(p),m.append(g,v),h.append(this.ratingDistribution),u.append(m,this.reviewList),this.rootElement.append(h),this.rootElement.append(u)}};Ut=St=function(t,e,i,n){var s,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(a=(r<3?s(a):r>3?s(e,i,a):s(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a}([h({selector:"etrusted-product-review-list-widget"})],Ut)})()})();
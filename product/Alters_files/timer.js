(()=>{var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";function n(t){return{border:`${t.size}px solid ${t.color}`,borderRadius:`${t.radius}px`}}function i(t){const e={fontSize:`${t.size}px`,color:t.color};return t.weight&&(e.fontWeight=t.weight),e}function r(t){return t&&"single_color"===t.type?{backgroundColor:t.color}:t&&"gradient"===t.type?{backgroundImage:`linear-gradient(${t.angle}deg, ${t.start_color}, ${t.end_color})`}:{}}function a(t){return{marginTop:t.top?`${t.top}px`:void 0,marginBottom:t.bottom?`${t.bottom}px`:void 0,marginLeft:t.left?`${t.left}px`:void 0,marginRight:t.right?`${t.right}px`:void 0}}function s({tagName:t,style:e,innerHTML:n,children:i,addClasses:r}){const a=document.createElement(t);for(const t of r||[])a.classList.add(t);return e&&Object.assign(a.style,e),void 0!==n&&(a.innerHTML=n),i&&i.forEach((t=>a.appendChild(t))),a}t.r(e),t.d(e,{TimerWidget:()=>o,TimerWidgetController:()=>h,TimerWidgetSkeleton:()=>l});class o{constructor({template:t,container:e,localeCode:n}){this.template=t,this.container=e,this.localeCode=n}render(t){var e;this.container.innerHTML="",this.container.appendChild(s({tagName:"div",style:Object.assign(Object.assign(Object.assign(Object.assign({display:"flex",flexFlow:"column",alignItems:"center"},(e=this.template.style.padding,{paddingTop:e.top?`${e.top}px`:void 0,paddingBottom:e.bottom?`${e.bottom}px`:void 0,paddingLeft:e.left?`${e.left}px`:void 0,paddingRight:e.right?`${e.right}px`:void 0})),a(this.template.style.margin)),n(this.template.style.border)),r(this.template.style.background)),children:[this.createTitleAndSubtitleContainer(),this.createTimerElement(t)]}))}createTitleAndSubtitleContainer(){return s({tagName:"div",style:{textAlign:"center"},children:[s({tagName:"h2",innerHTML:this.getTitle(),style:Object.assign(Object.assign(Object.assign({},i(this.template.style.title)),this.fontFamilyStyle()),{fontWeight:"bold",lineHeight:"1",margin:"0",padding:"0"})}),s({tagName:"p",innerHTML:this.getSubtitle(),style:Object.assign(Object.assign(Object.assign({},i(this.template.style.subtitle)),this.fontFamilyStyle()),{lineHeight:"1.5",margin:"0",padding:"0"})})]})}createTimerElement(t){const e=Object.assign(Object.assign(Object.assign({},i(this.template.style.timer)),this.fontFamilyStyle()),{fontWeight:"bold",fontFeatureSettings:"tnum",fontVariantNumeric:"tabular-nums"}),n=Object.assign(Object.assign(Object.assign({},i(this.template.style.timer)),this.fontFamilyStyle()),{fontWeight:"bold"}),r=Object.assign(Object.assign({},i(this.template.style.timer_label)),this.fontFamilyStyle());return s({tagName:"span",style:{lineHeight:"1"},children:[s({tagName:"div",style:{display:"grid",gridTemplateColumns:"1fr 10px 1fr 10px 1fr 10px 1fr",textAlign:"center",rowGap:"6px",columnGap:"5px",paddingTop:"4px"},children:[s({tagName:"div",innerHTML:t.days.toString().padStart(2,"0"),style:e}),s({tagName:"div",innerHTML:":",style:n}),s({tagName:"div",innerHTML:t.hours.toString().padStart(2,"0"),style:e}),s({tagName:"div",innerHTML:":",style:n}),s({tagName:"div",innerHTML:t.minutes.toString().padStart(2,"0"),style:e}),s({tagName:"div",innerHTML:":",style:n}),s({tagName:"div",innerHTML:t.seconds.toString().padStart(2,"0"),style:e}),s({tagName:"div",innerHTML:this.getDaysLabel(),style:Object.assign(Object.assign({},r),{paddingRight:"10px",gridRowStart:"2",gridColumnStart:"1",gridColumnEnd:"2"})}),s({tagName:"div",innerHTML:this.getHoursLabel(),style:Object.assign(Object.assign({},r),{paddingRight:"10px",gridRowStart:"2",gridColumnStart:"3",gridColumnEnd:"4"})}),s({tagName:"div",innerHTML:this.getMinutesLabel(),style:Object.assign(Object.assign({},r),{paddingRight:"10px",gridRowStart:"2",gridColumnStart:"5",gridColumnEnd:"6"})}),s({tagName:"div",innerHTML:this.getSecondsLabel(),style:Object.assign(Object.assign({},r),{gridRowStart:"2",gridColumnStart:"7",gridColumnEnd:"7"})})]})]})}fontFamilyStyle(){return{fontFamily:this.template.style.font||"inherit"}}getTitle(){var t;return(null===(t=this.getTranslation())||void 0===t?void 0:t.title)||this.template.title}getSubtitle(){var t;return(null===(t=this.getTranslation())||void 0===t?void 0:t.subtitle)||this.template.subtitle}getDaysLabel(){const t=this.getTranslation();return(null==t?void 0:t.days)||this.template.days}getHoursLabel(){const t=this.getTranslation();return(null==t?void 0:t.hours)||this.template.hours}getMinutesLabel(){const t=this.getTranslation();return(null==t?void 0:t.minutes)||this.template.minutes}getSecondsLabel(){const t=this.getTranslation();return(null==t?void 0:t.seconds)||this.template.seconds}getTranslation(){if(this.template.translations&&this.localeCode)return this.template.translations[this.localeCode]}}class l{constructor({container:t,icon:e}){this.container=t,this.icon=e}render(){this.container.innerHTML="";const t=s({tagName:"img",style:{width:"100px",height:"100px",marginTop:"0px",marginBottom:"0px"}});t.src=this.icon,this.container.appendChild(s({tagName:"div",style:{backgroundColor:"#fffffff",display:"flex",flexFlow:"column",alignItems:"center",paddingTop:"20px",paddingBottom:"20px"},children:[t,s({tagName:"span",innerHTML:"The timer will appear here",style:{textAlign:"center"}}),s({tagName:"span",innerHTML:"(Only visible in theme editor)",style:{textAlign:"center"}})]}))}}const c={selector:".rockit-sales-manager-timer-embed",position:"append"},d="rockit-sales-manager-timer-widget";class h{constructor({productVariants:t,templates:e,localeCode:n,blockId:i,timerIcon:r,showPlaceholder:a}){this.productVariants=t,this.templates=e,this.localeCode=n,this.blockId=i,this.timerIcon=r,this.showPlaceholder=a}start({selectedProductVariantId:t}){this.onProductVariantChange(t||""),setInterval(this.render.bind(this),1e3),document.addEventListener("change",(()=>{const t=new URL(document.URL).searchParams.get("variant");t&&this.onProductVariantChange(t||"")}))}onProductVariantChange(t){var e,n;this.currentVariant&&t===this.currentVariant.id||(this.clearCurrentContainer(),this.currentVariant=this.productVariants[t],this.currentVariant?(this.currentSale=function(t){try{const e=JSON.parse(t)||{},n=e.timer_id||void 0;if("string"!=typeof n&&void 0!==n)return;const i=e.end_at||void 0;if("number"!=typeof i&&void 0!==i)return;return{timerId:n,endsAt:i}}catch(t){return}}((null===(e=this.currentVariant)||void 0===e?void 0:e.sale)||""),this.currentTemplate=this.templates[(null===(n=this.currentSale)||void 0===n?void 0:n.timerId)||""]):(this.currentSale=void 0,this.currentTemplate=void 0),this.render())}render(){const t=this.createContainer();if(t!==this.currentContainer&&this.clearCurrentContainer(),this.currentContainer=t,!this.currentContainer)return;const e=this.remainingTime();if(!this.currentSale||!this.currentTemplate||!e)return this.clearCurrentContainer(),this.renderSkeleton();const n=new o({template:this.currentTemplate,container:this.currentContainer,localeCode:this.localeCode});this.currentContainer.style.display="block",n.render(e),this.subscribeToDomChangesObserver()}renderSkeleton(){if(this.showPlaceholder&&this.timerIcon&&this.currentContainer){const t=new l({container:this.currentContainer,icon:this.timerIcon});this.currentContainer.style.display="block",t.render()}}remainingTime(){if(!this.currentSale||!this.currentSale.endsAt)return;const t=new Date(1e3*this.currentSale.endsAt).getTime()-(new Date).getTime();if(t>0){const e=Math.floor(t/1e3%60),n=Math.floor(t/1e3/60%60),i=Math.floor(t/36e5%24);return{days:Math.floor(t/864e5),hours:i,minutes:n,seconds:e}}}clearCurrentContainer(){this.unsubscribeFromDomChangesObserver(),this.currentContainer&&(this.currentContainer.innerHTML="",this.currentContainer.style.display="none")}unsubscribeFromDomChangesObserver(){this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=void 0)}subscribeToDomChangesObserver(){this.blockId||!this.currentContainer||this.mutationObserver||(this.mutationObserver=new MutationObserver((()=>{this.currentContainer&&!document.body.contains(this.currentContainer)&&this.render()})),this.mutationObserver.observe(this.getObservableNode(this.currentContainer),{childList:!0,subtree:!0}))}getObservableNode(t){let e=t;for(let t=0;t<3&&e.parentElement;t++)e=e.parentElement;return e}createContainer(){if(this.blockId)return document.querySelector(`#${this.blockId}`);if(!this.currentTemplate)return null;if(document.querySelector(".rockit-sales-manager-timer-app-block"))return null;const t=document.querySelector(`.${d}`);if(t)return t;const e=(i=this.currentTemplate).placement&&i.placement.selector?i.placement:c,n=document.querySelector(e.selector);var i;if(n){const t=s({tagName:"div",addClasses:[d],style:{display:"none"}});return function(t,e,n="append"){var i,r;switch(n){case"append":default:t.appendChild(e);break;case"prepend":t.prepend(e);break;case"before":null===(i=t.parentNode)||void 0===i||i.insertBefore(e,t);break;case"after":null===(r=t.parentNode)||void 0===r||r.insertBefore(e,t.nextSibling)}}(n,t,e.position),t}return null}}})();var n=RockitSalesManager="undefined"==typeof RockitSalesManager?{}:RockitSalesManager;for(var i in e)n[i]=e[i];e.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();
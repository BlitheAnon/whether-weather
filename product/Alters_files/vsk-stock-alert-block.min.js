class VskStockAlertBlock extends HTMLElement{constructor(){super(),this.variants=JSON.parse(this.dataset.variants),this.configuration=JSON.parse(this.dataset.config),this.eventsRegistered=!1,this.lastEventFired=undefined,this.lastVariantID=0}connectedCallback(){this.generateStockOutInfo(),this.registerVariantChangeEventListeners()}handler(t){this.lastEventFired!=t&&(this.lastEventFired=t,setTimeout(()=>{let t=this.findCurrentVariantID();this.lastVariantID!=t&&this.generateStockOutInfo(t)},100))}registerVariantChangeEventListeners(){const t=this;if(!this.eventsRegistered){let e=document.querySelectorAll("input, select, button, li, div, span, label, img, a");Object.entries(e).forEach(([e,n])=>{"length"!=e&&("SELECT"==n.tagName||"INPUT"==n.tagName?n.addEventListener("change",e=>{t.handler(e)}):n.addEventListener("click",e=>{t.handler(e)}))}),["vsk:selection:release","vsk:product:variant:changed"].forEach(e=>{document.addEventListener(e,e=>{t.generateStockOutInfo(e.variantId)})}),document.addEventListener("vsk:manual:selection:hold",()=>{t.innerHTML=""}),this.eventsRegistered=!0}}findCurrentVariantID(){let t=null,e={};if(document.location.search.substr(1).split("&").forEach(t=>{var n=t.split("=");try{e[n[0].toString()]=n[1].toString()}catch(i){}}),isNaN(e.variant)){let e=document.querySelector('form[action="/cart/add"] [name="id"]:checked')||document.querySelector('select[name="id"]')||document.querySelector('[name="id"]');e&&(t=e.value)}else e.variant&&(t=e.variant);return t}getVariantById(t){return this.variants.find(e=>e.id==t)}replaceInventoryQuantity(t,e){return t.replace(/{{\s*inventory\s*}}/,e.inventory_quantity)}parseHTML(t){var e=document.implementation.createHTMLDocument("");return e.body.innerHTML=t,e.body.children}getTranslation(t){let e=this.configuration.localized_strings[t];return e&&(e=e[window.Shopify.locale])&&e.trim().length>0?e:t}generateStockOutInfo(t=null){if(!window.starapps_stock_data||window.starapps_stock_data.show_stock_alert)if(this.configuration){let e=t||this.findCurrentVariantID();this.lastVariantID=e;let n=this.getVariantById(e);if(this.innerHTML="",n&&n.inventory_quantity>0&&n.inventory_quantity<=this.configuration.config.threshold){let t=this.getTranslation(this.configuration.config.message),e=this.parseHTML(this.replaceInventoryQuantity(t,n))[0],i=document.createElement("div"),a=document.createElement("div");a.classList.add(`star-stock-align-${this.configuration.config.alignment}`),a.appendChild(e),i.appendChild(a),this.innerHTML=i.innerHTML}}else console.log("inventory configuration is not available..")}}customElements.define("vsk-stock-alert-block",VskStockAlertBlock);
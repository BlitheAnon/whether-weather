<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <!-- 设置屏幕缩放比 -->
    <!-- <meta name="viewport" content="width=device-width,initial-scale=1"> -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">  
    <title>whether weather</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/weather-logo.css">
    <link rel="stylesheet" href="css/response.css">
    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script type="text/javascript" src="city/city.json"></script>
    <!-- 引入 echarts.js -->
    <script src="https://cdn.bootcss.com/echarts/4.2.1-rc1/echarts.min.js"></script>
</head>

<body>
    <!-- 用于jsonp跨域动态添加script标签 -->
    <div id="jsonp-area">
    </div>
    <!-- 顶部搜索栏 -->
    <header>
        <div>
            <i class="fa fa-search fa-lg" id="search_btn"></i>
            <input id="input_key" type="text" placeholder="输入地区名搜索" oninput="preRequestCity(this.value)">
            <i id="ipt_delete" class="fa fa-times-circle fa-lg" onclick="removeIput()"></i>
        </div>
        <ul id="city_list">
        </ul>
    </header>

    <main>
        <div class="main-container">
            <div class="main-top">
                <span class="main-left">
                    <i class="fa fa-map-marker fa-lg"></i>
                    <span id="now_city">-</span>
                </span>
                <span class="main-right">
                    <span id="update_time">--:--</span>
                    <span>更新</span>
                </span>
            </div>

            <div class="main-main">
                <span id="now_tem">-</span>
                <span>
                    <span id="now_wea">-</span>
                    <span>/</span>
                    <span id="now_win">-</span>
                </span>
                <span id="now_air_container">
                    <span id="now_air">-</span>
                    <span id="now_air_level">-</span>
                </span>
            </div>

            <div class="main-bottom">
                <span class="main-left">
                    <span>今天:</span>
                    <span id="now_today_wea">-</span>
                </span>
                <span class="main-right">
                    <span id="now_low_tem">-</span>~<span id="now_high_tem">-</span>°C
                </span>
            </div>
        </div>
    </main>

    <div id="wea_chart"></div>

    <!-- <main>
        <div class="main-container">
            <div class="main-top">
                <span class="main-left">
                    <i class="fa fa-map-marker fa-lg"></i>
                    <span id="now_city">北京</span>
                </span>
                <span class="main-right">
                    <span id="update_time">12:12</span>
                    <span>更新</span>
                </span>
            </div>

            <div class="main-main">
                <span id="now_tem">13</span>
                <span>
                    <span id="now_wea">晴</span>
                    <span>/</span>
                    <span id="now_win">北风</span>
                </span>
                <span id="now_air_container">
                    <span id="now_air">20</span>
                    <span id="now_air_level">良</span>
                </span>
            </div>

            <div class="main-bottom">
                <span class="main-left">
                    <span>今天:</span>
                    <span id="now_today_wea">雨</span>
                </span>
                <span class="main-right">
                    <span id="now_low_tem">20</span>~<span id="now_high_tem">30</span>°C
                </span>
            </div>
        </div>
    </main> -->


    <footer>
        <!-- <div class="square">
                <img class="sunny" alt="">
                <div>
                    <span>北京</span>
                    <span>/</span>
                    <span>阴</span>
                </div>
                <div>23°C</div>
            </div> -->
    </footer>

    <!-- 取得访问者ip -->
    <script src="https://pv.sohu.com/cityjson?ie=utf-8"></script>
    <script type="text/javascript" src="js/function.js"></script>
    <script type="text/javascript" src="js/match.js"></script>
    <script type="text/javascript">
        window.onload = function() {
            //点击其他区域隐藏搜索结果下拉列表
            document.onclick = function() {　　　　　　　　
                //清除列表
                document.getElementById('city_list').innerHTML='';
            }

            // 监听输入


            //刷新页面后读取sessionStorage
            pageReload();
            // var footer = document.getElementsByTagName('footer')[0];
            // //设置天气个数
            // var cityCount = 8;
            // for (var i = 0; i < cityCount; i++) {
            //     var node = document.createElement('div');
            //     node.setAttribute('class', 'square');
            //     node.innerHTML = '<img class="sunny"><div>北京</div><div>23</div>';
            //     footer.appendChild(node);
            // }

            let _userIP = returnCitySN["cip"];
            loadTodayWeatherByIP(_userIP);
            loadWeekWeatherByIP(_userIP);

            //监听input，回车事件
            // document.getElementsByTagName('input')[0].addEventListener('keypress', function(e) {
            //     var key = e.which || e.keyCode;
            //     if (key === 13) { // 13 is enter
            //         let inputCity = document.getElementsByTagName('input')[0].value.trim();
            //         //回车后新增一个城市
            //         if (!(inputCity == '')) {
            //             matchCity(inputCity);
            //         }
            //     }
            // });

            //监听点击搜索按钮
            // document.getElementById('search_btn').addEventListener('click', function() {
            //     let inputCity = document.getElementsByTagName('input')[0].value.trim();
            //     //回车后新增一个城市
            //     if (!(inputCity == '')) {
            //         requestCity(inputCity);
            //     }
            // });


            //监听点击城市列表项

        }
    </script>
    <script type="text/javascript">
        function createWeekEchart(logo_arr, high_tem_arr, low_tem_arr, win_arr, air_arr, _min, _max) {
            // 基于准备好的dom，初始化echarts实例
            var myChart = echarts.init(document.getElementById('wea_chart'));

            // 指定图表的配置项和数据
            option = {
                grid: {
                    top: '0',
                    left: '0',
                    right: '0',
                    bottom: '0',
                },
                xAxis: [{
                    offset: -205,
                    type: 'category',
                    data: getWeekArray(),
                    axisLine: {
                        show: false,
                    },
                    axisTick: {
                        show: false,
                    },
                    axisLabel: {
                        interval: 0, //设置成 0 强制显示所有标签。
                    }
                }, {
                    offset: -40,
                    type: 'category',
                    data: get7Day(),
                    axisLine: {
                        show: false,
                    },
                    axisTick: {
                        show: false,
                    },
                    axisLabel: {
                        interval: 0, //设置成 0 强制显示所有标签。
                    }
                }, {
                    offset: -80,
                    type: 'category',
                    data: logo_arr,
                    axisLine: {
                        show: false,
                    },
                    axisTick: {
                        show: false,
                    },
                    axisLabel: {
                        formatter: function(value) {
                            return weaLogoRichMatch(value);
                        },
                        interval: 0, //设置成 0 强制显示所有标签。
                        margin: 0,
                        rich: { //x轴刻度标签的自定义--图片+文字
                            sunny: { //与data中的数组元素要对应
                                width: 40,
                                height: 40,
                                backgroundColor: {
                                    image: 'images/sunny.svg',
                                }
                            },
                            snow: {
                                width: 40,
                                height: 40,
                                backgroundColor: {
                                    image: 'images/snow.svg',
                                }
                            },
                            dust: {
                                width: 40,
                                height: 40,
                                backgroundColor: {
                                    image: 'images/dust.svg',
                                }
                            },
                            fog: {
                                width: 40,
                                height: 40,
                                backgroundColor: {
                                    image: 'images/fog.svg',
                                }
                            },
                            hail: {
                                width: 40,
                                height: 40,
                                backgroundColor: {
                                    image: 'images/hail.svg',
                                }
                            },
                            cloud: {
                                width: 40,
                                height: 40,
                                backgroundColor: {
                                    image: 'images/cloud.svg',
                                }
                            },
                            rain: {
                                width: 40,
                                height: 40,
                                backgroundColor: {
                                    image: 'images/rain.svg',
                                }
                            },
                            cloudy: {
                                width: 40,
                                height: 40,
                                backgroundColor: {
                                    image: 'images/cloudy.svg',
                                }
                            }
                        }
                    }
                }, {
                    offset: -180,
                    type: 'category',
                    data: win_arr,
                    splitLine: {
                        show: true,
                        interval: 0,
                        lineStyle: {
                            color: '#e0e0e0',
                        },
                    },
                    axisLine: {
                        show: false,
                    },
                    axisTick: {
                        show: false,
                    },
                    axisLabel: {
                        interval: 0,
                    }
                }, {
                    offset: -200,
                    type: 'category',
                    data: air_arr,
                    //data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    axisLine: {
                        show: false,
                    },
                    axisTick: {
                        show: false,
                    },
                    axisLabel: { //刻度标签--即轴线下的文字
                        formatter: function(value) {
                            return airRichMatch(value);
                        },
                        interval: 0, //设置成 0 强制显示所有标签。
                        margin: 0,
                        rich: { //x轴刻度标签的自定义--图片+文字
                            level_1: { //与data中的数组元素要对应
                                width: 40,
                                height: 20,
                                align: 'center',
                                backgroundColor: '#9ccc65',
                                borderRadius: 4,
                                color: '#ffffff',
                            },
                            level_2: {
                                width: 40,
                                height: 20,
                                lineHeight: 20,
                                align: 'center',
                                backgroundColor: '#ffd600',
                                borderRadius: 4,
                                color: '#ffffff',
                            },
                            level_3: {
                                width: 40,
                                height: 20,
                                lineHeight: 20,
                                align: 'center',
                                backgroundColor: 'ORANGE',
                                borderRadius: 4,
                                color: '#ffffff',
                            },
                            level_4: {
                                width: 40,
                                height: 20,
                                lineHeight: 20,
                                align: 'center',
                                backgroundColor: 'RED',
                                borderRadius: 4,
                                color: '#ffffff',
                            },
                            level_5: {
                                width: 40,
                                height: 20,
                                lineHeight: 20,
                                align: 'center',
                                backgroundColor: 'PURPLE',
                                borderRadius: 4,
                                color: '#ffffff',
                            },
                            level_6: {
                                width: 40,
                                height: 20,
                                lineHeight: 20,
                                align: 'center',
                                backgroundColor: 'BROWN',
                                borderRadius: 4,
                                color: '#ffffff',
                            }
                        }
                    }
                }],
                yAxis: {
                    show: false,
                    splitLine: {
                        show: false,
                        interval: 0,
                    },
                    min: _min,
                    max: _max,
                    axisTick: {
                        show: false,
                    },
                    axisLabel: {
                        show: false,
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#e0e0e0',
                        }
                    }
                },
                series: [{
                    data: high_tem_arr,
                    type: 'line',
                    smooth: true,
                    lineStyle: {
                        color: '#bdbdbd',
                    },
                    label: {
                        show: true,
                        position: 'top',
                        formatter: function(param) {
                            //匹配数组第一个值
                            if (param.dataIndex == 0) {
                                return '{light|' + param.value + '}';
                            }
                        },
                        interval: 0, //设置成 0 强制显示所有标签。
                        rich: {
                            light: { //设置第一个点颜色
                                color: '#000000',
                            }
                        }
                    },
                    itemStyle: {
                        // borderColor: '#000000',
                        // borderWidth: 2,
                        //回调函数设置第一个点颜色
                        color: function(param) {
                            if (param.dataIndex == 0) {
                                return '#000000';
                            } else {
                                return '#9e9e9e';
                            }
                        }
                    }
                }, {
                    data: low_tem_arr,
                    type: 'line',
                    smooth: true,
                    lineStyle: {
                        color: '#e0e0e0',
                    },
                    label: {
                        show: true,
                        position: 'bottom',
                        formatter: function(param) {
                            //匹配数组第一个值
                            if (param.dataIndex == 0) {
                                return '{light|' + param.value + '}';
                            }
                        },
                        interval: 0, //设置成 0 强制显示所有标签。
                        rich: {
                            light: { //设置第一个点颜色
                                color: '#000000',
                            }
                        }
                    },
                    itemStyle: {
                        color: function(param) {
                            if (param.dataIndex == 0) {
                                return '#000000';
                            } else {
                                return '#9e9e9e';
                            }
                        }
                    }
                }]
            };

            // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option);

            window.onresize = myChart.resize;
        }
    </script>
</body>

</html>
